!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=require("vscode")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);function s(e,t,n=" "){return n.repeat(Math.max(0,t-e.length))+e}const r=new class{constructor(){this.output=o.window.createOutputChannel("GitHub Authentication")}data2String(e){return e instanceof Error?e.stack||e.message:!1===e.success&&e.message?e.message:e.toString()}info(e,t){this.logLevel("Info",e,t)}error(e,t){this.logLevel("Error",e,t)}logLevel(e,t,n){this.output.appendLine(`[${e}  - ${this.now()}] ${t}`),n&&this.output.appendLine(this.data2String(n))}now(){const e=new Date;return s(e.getUTCHours()+"",2,"0")+":"+s(e.getMinutes()+"",2,"0")+":"+s(e.getUTCSeconds()+"",2,"0")+"."+e.getMilliseconds()}};t.default=r},function(e,t){e.exports=require("path")},function(e,t,n){var o=n(10),s=n(12),r=s;r.v1=o,r.v4=s,e.exports=r},function(e,t,n){var o=n(11);e.exports=function(){return o.randomBytes(16)}},function(e,t){for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);e.exports=function(e,t){var o=t||0,s=n;return[s[e[o++]],s[e[o++]],s[e[o++]],s[e[o++]],"-",s[e[o++]],s[e[o++]],"-",s[e[o++]],s[e[o++]],"-",s[e[o++]],s[e[o++]],"-",s[e[o++]],s[e[o++]],s[e[o++]],s[e[o++]],s[e[o++]],s[e[o++]]].join("")}},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GitHubServer=t.uriHandler=void 0;const o=n(16),s=n(0),r=n(3),i=n(17),a=n(1),c=n(18);t.uriHandler=new class extends s.EventEmitter{handleUri(e){this.fire(e)}};const u=(e,t)=>async(n,s,r)=>{a.default.info("Exchanging code for token...");const i=function(e){return e.query.split("&").reduce((e,t)=>{const n=t.split("=");return e[n[0]]=n[1],e},{})}(n),c=i.code;if(i.state!==e)return void r("Received mismatched state");const u=o.request({host:"github.com",path:`/login/oauth/access_token?client_id=${t.id}&client_secret=${t.secret}&state=${i.state}&code=${c}`,method:"POST",headers:{Accept:"application/json"}},e=>{const t=[];e.on("data",e=>{t.push(e)}),e.on("end",()=>{if(200===e.statusCode){const e=JSON.parse(Buffer.concat(t).toString());a.default.info("Token exchange success!"),s(e.access_token)}else r(new Error(e.statusMessage))})});u.end(),u.on("error",e=>{r(e)})};t.GitHubServer=class{async login(e){a.default.info("Logging in...");const n=r(),o=await s.env.asExternalUri(s.Uri.parse(`${s.env.uriScheme}://vscode.github-authentication/did-authenticate`)),l="vso"===e?c.default.getGitHubAppDetails():c.default.getClientDetails(o),d=s.Uri.parse(`https://github.com/login/oauth/authorize?redirect_uri=${encodeURIComponent(o.toString())}&scope=${e}&state=${n}&client_id=${l.id}`);return s.env.openExternal(d),i.promiseFromEvent(t.uriHandler.event,u(n,l))}async hasUserInstallation(e){return new Promise((t,n)=>{a.default.info("Getting user installations...");const s=o.request({host:"api.github.com",path:"/user/installations",method:"GET",headers:{Accept:"application/vnd.github.machine-man-preview+json",Authorization:`token ${e}`,"User-Agent":"Visual-Studio-Code"}},e=>{const o=[];e.on("data",e=>{o.push(e)}),e.on("end",()=>{if(200===e.statusCode){const e=JSON.parse(Buffer.concat(o).toString());a.default.info("Got installation info!");const n=e.installations.some(e=>"microsoft-visual-studio-code"===e.app_slug);t(n)}else n(new Error(e.statusMessage))})});s.end(),s.on("error",e=>{n(e)})})}async installApp(){const e=c.default.getGitHubAppDetails(),n=r(),o=s.Uri.parse(`https://github.com/apps/microsoft-visual-studio-code/installations/new?state=${n}`);return s.env.openExternal(o),i.promiseFromEvent(t.uriHandler.event,u(n,e))}async getUserInfo(e){return new Promise((t,n)=>{a.default.info("Getting account info...");const s=o.request({host:"api.github.com",path:"/user",method:"GET",headers:{Authorization:`token ${e}`,"User-Agent":"Visual-Studio-Code"}},e=>{const o=[];e.on("data",e=>{o.push(e)}),e.on("end",()=>{if(200===e.statusCode){const e=JSON.parse(Buffer.concat(o).toString());a.default.info("Got account info!"),t({id:e.id,accountName:e.login})}else n(new Error(e.statusMessage))})});s.end(),s.on("error",e=>{n(e)})})}async revokeToken(e){return new Promise(async(t,n)=>{const r=await s.env.asExternalUri(s.Uri.parse(`${s.env.uriScheme}://vscode.github-authentication/did-authenticate`)),i=c.default.getClientDetails(r),u=`${i.id}:${i.secret}`,l=JSON.stringify({access_token:e});a.default.info("Revoking token...");const d=o.request({host:"api.github.com",path:`/applications/${i.id}/token`,method:"DELETE",headers:{Authorization:`Basic ${Buffer.from(u).toString("base64")}`,"User-Agent":"Visual-Studio-Code","Content-Type":"application/json","Content-Length":Buffer.byteLength(l)}},e=>{const o=[];e.on("data",e=>{o.push(e)}),e.on("end",()=>{204===e.statusCode?(a.default.info("Revoked token!"),t()):n(new Error(e.statusMessage))})});d.write(l),d.end(),d.on("error",e=>{n(e)})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const o=n(0),s=n(9),r=n(7),i=n(1);t.activate=async function(e){e.subscriptions.push(o.window.registerUriHandler(r.uriHandler));const t=new s.GitHubAuthenticationProvider;await t.initialize(),o.authentication.registerAuthenticationProvider({id:"github",displayName:"GitHub",onDidChangeSessions:s.onDidChangeSessions.event,getSessions:()=>Promise.resolve(t.sessions),login:async e=>{try{const n=await t.login(e.join(" "));return i.default.info("Login success!"),s.onDidChangeSessions.fire({added:[n.id],removed:[],changed:[]}),n}catch(e){throw o.window.showErrorMessage(`Sign in failed: ${e}`),i.default.error(e),e}},logout:async e=>{await t.logout(e),s.onDidChangeSessions.fire({added:[],removed:[e],changed:[]})}})},t.deactivate=function(){}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GitHubAuthenticationProvider=t.onDidChangeSessions=void 0;const o=n(0),s=n(3),r=n(13),i=n(7),a=n(1);t.onDidChangeSessions=new o.EventEmitter;t.GitHubAuthenticationProvider=class{constructor(){this._sessions=[],this._githubServer=new i.GitHubServer}async initialize(){this._sessions=await this.readSessions(),this.pollForChange()}pollForChange(){setTimeout(async()=>{const e=await this.readSessions(),n=[],o=[];e.forEach(e=>{this._sessions.some(t=>t.id===e.id)||(this._sessions.push(e),n.push(e.id))}),this._sessions.map(t=>{if(!e.some(e=>e.id===t.id)){const e=this._sessions.findIndex(e=>e.id===t.id);e>-1&&this._sessions.splice(e,1),o.push(t.id)}}),(n.length||o.length)&&t.onDidChangeSessions.fire({added:n,removed:o,changed:[]}),this.pollForChange()},3e4)}async readSessions(){const e=await r.keychain.getToken();if(e)try{return JSON.parse(e).map(e=>({id:e.id,accountName:e.accountName,scopes:e.scopes,getAccessToken:()=>Promise.resolve(e.accessToken)}))}catch(e){a.default.error(`Error reading sessions: ${e}`)}return[]}async storeSessions(){const e=await Promise.all(this._sessions.map(async e=>{const t=await e.getAccessToken();return{id:e.id,accountName:e.accountName,scopes:e.scopes,accessToken:t}}));await r.keychain.setToken(JSON.stringify(e))}get sessions(){return this._sessions}async login(e){const t="vso"===e?await this.loginAndInstallApp(e):await this._githubServer.login(e),n=await this.tokenToSession(t,e.split(" "));return await this.setToken(n),n}async loginAndInstallApp(e){const t=await this._githubServer.login(e);return await this._githubServer.hasUserInstallation(t)?t:this._githubServer.installApp()}async tokenToSession(e,t){const n=await this._githubServer.getUserInfo(e);return{id:s(),getAccessToken:()=>Promise.resolve(e),accountName:n.accountName,scopes:t}}async setToken(e){const t=this._sessions.findIndex(t=>t.id===e.id);t>-1?this._sessions.splice(t,1,e):this._sessions.push(e),this.storeSessions()}async logout(e){const t=this._sessions.findIndex(t=>t.id===e);if(t>-1){const e=this._sessions.splice(t,1)[0],n=await e.getAccessToken();await this._githubServer.revokeToken(n)}this.storeSessions()}}},function(e,t,n){var o,s,r=n(4),i=n(5),a=0,c=0;e.exports=function(e,t,n){var u=t&&n||0,l=t||[],d=(e=e||{}).node||o,f=void 0!==e.clockseq?e.clockseq:s;if(null==d||null==f){var g=r();null==d&&(d=o=[1|g[0],g[1],g[2],g[3],g[4],g[5]]),null==f&&(f=s=16383&(g[6]<<8|g[7]))}var h=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:c+1,p=h-a+(v-c)/1e4;if(p<0&&void 0===e.clockseq&&(f=f+1&16383),(p<0||h>a)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=h,c=v,s=f;var m=(1e4*(268435455&(h+=122192928e5))+v)%4294967296;l[u++]=m>>>24&255,l[u++]=m>>>16&255,l[u++]=m>>>8&255,l[u++]=255&m;var y=h/4294967296*1e4&268435455;l[u++]=y>>>8&255,l[u++]=255&y,l[u++]=y>>>24&15|16,l[u++]=y>>>16&255,l[u++]=f>>>8|128,l[u++]=255&f;for(var S=0;S<6;++S)l[u+S]=d[S];return t||i(l)}},function(e,t){e.exports=require("crypto")},function(e,t,n){var o=n(4),s=n(5);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[r+a]=i[a];return t||s(i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keychain=t.Keychain=void 0;const o=n(0),s=n(1),r=n(14).loadMessageBundle(n(2).join(__dirname,"common/keychain.ts"));const i=`${o.env.uriScheme}-github.login`,a="account";class c{constructor(){const e=function(){try{return n(15)}catch(e){console.log(e)}}();if(!e)throw new Error("System keychain unavailable");this.keytar=e}async setToken(e){try{return await this.keytar.setPassword(i,a,e)}catch(e){s.default.error(`Setting token failed: ${e}`);const t=r(0,null);await o.window.showErrorMessage(r(1,null,e.message),t)===t&&o.env.openExternal(o.Uri.parse("https://code.visualstudio.com/docs/editor/settings-sync#_troubleshooting-keychain-issues"))}}async getToken(){try{return await this.keytar.getPassword(i,a)}catch(e){return s.default.error(`Getting token failed: ${e}`),Promise.resolve(void 0)}}async deleteToken(){try{return await this.keytar.deletePassword(i,a)}catch(e){return s.default.error(`Deleting token failed: ${e}`),Promise.resolve(void 0)}}}t.Keychain=c,t.keychain=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,s,r,i,a,c,u=n(2),l=n(6),d=Object.prototype.toString;function f(e){return void 0!==e}function g(e){return"[object String]"===d.call(e)}function h(e){return JSON.parse(l.readFileSync(e,"utf8"))}function v(e,t){return c&&(e="［"+e.replace(/[aouei]/g,"$&$&")+"］"),0===t.length?e:e.replace(/\{(\d+)\}/g,function(e,n){var o=n[0],s=t[o],r=e;return"string"==typeof s?r=s:"number"!=typeof s&&"boolean"!=typeof s&&void 0!==s&&null!==s||(r=String(s)),r})}function p(e){return function(t,n){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];return function(e){return"[object Number]"===d.call(e)}(t)?t>=e.length?void console.error("Broken localize call found. Index out of bounds. Stacktrace is\n: "+new Error("").stack):v(e[t],o):g(n)?(console.warn("Message "+n+" didn't get externalized correctly."),v(n,o)):void console.error("Broken localize call found. Stacktrace is\n: "+new Error("").stack)}}function m(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return v(t,n)}function y(e,t){return i[e]=t,t}function S(e,t){var n,o=u.join(a.cacheRoot,e.id+"-"+e.hash+".json"),s=!1,r=!1;try{return n=JSON.parse(l.readFileSync(o,{encoding:"utf8",flag:"r"})),function(e){var t=new Date;l.utimes(e,t,t,function(){})}(o),n}catch(e){if("ENOENT"===e.code)r=!0;else{if(!(e instanceof SyntaxError))throw e;console.log("Syntax error parsing message bundle: "+e.message+"."),l.unlink(o,function(e){e&&console.error("Deleting corrupted bundle "+o+" failed.")}),s=!0}}if(!(n=function(e,t){var n=a.translationsConfig[e.id];if(n){var o=h(n).contents,s=h(u.join(t,"nls.metadata.json")),r=Object.create(null);for(var i in s){var c=s[i],l=o[e.outDir+"/"+i];if(l){for(var d=[],f=0;f<c.keys.length;f++){var v=c.keys[f],p=l[g(v)?v:v.key];void 0===p&&(p=c.messages[f]),d.push(p)}r[i]=d}else r[i]=c.messages}return r}}(e,t))||s)return n;if(r)try{l.writeFileSync(o,JSON.stringify(n),{encoding:"utf8",flag:"wx"})}catch(e){if("EEXIST"===e.code)return n;throw e}return n}function b(e){try{return function(e){var t=h(u.join(e,"nls.metadata.json")),n=Object.create(null);for(var o in t){var s=t[o];n[o]=s.messages}return n}(e)}catch(e){return void console.log("Generating default bundle from meta data failed.",e)}}function _(e,t){var n;if(!0===a.languagePackSupport&&void 0!==a.cacheRoot&&void 0!==a.languagePackId&&void 0!==a.translationsConfigFile&&void 0!==a.translationsConfig)try{n=S(e,t)}catch(e){console.log("Load or create bundle failed ",e)}if(!n){if(a.languagePackSupport)return b(t);var o=function(e){for(var t=a.language;t;){var n=u.join(e,"nls.bundle."+t+".json");if(l.existsSync(n))return n;var o=t.lastIndexOf("-");t=o>0?t.substring(0,o):void 0}if(void 0===t&&(n=u.join(e,"nls.bundle.json"),l.existsSync(n)))return n}(t);if(o)try{return h(o)}catch(e){console.log("Loading in the box message bundle failed.",e)}n=b(t)}return n}function w(e){if(!e)return m;var t=u.extname(e);if(t&&(e=e.substr(0,e.length-t.length)),a.messageFormat===o.both||a.messageFormat===o.bundle){var n=function(e){for(var t,n=u.dirname(e);t=u.join(n,"nls.metadata.header.json"),!l.existsSync(t);){var o=u.dirname(n);if(o===n){t=void 0;break}n=o}return t}(e);if(n){var s=u.dirname(n),r=i[s];if(void 0===r)try{var d=JSON.parse(l.readFileSync(n,"utf8"));try{var g=_(d,s);r=y(s,g?{header:d,nlsBundle:g}:null)}catch(e){console.error("Failed to load nls bundle",e),r=y(s,null)}}catch(e){console.error("Failed to read header file",e),r=y(s,null)}if(r){var v=e.substr(s.length+1).replace(/\\/g,"/"),S=r.nlsBundle[v];return void 0===S?(console.error("Messages for file "+e+" not found. See console for details."),function(){return"Messages not found."}):p(S)}}}if(a.messageFormat===o.both||a.messageFormat===o.file)try{var b=h(function(e){var t;if(a.cacheLanguageResolution&&t)t=t;else{if(c||!a.language)t=".nls.json";else for(var n=a.language;n;){var o=".nls."+n+".json";if(l.existsSync(e+o)){t=o;break}var s=n.lastIndexOf("-");s>0?n=n.substring(0,s):(t=".nls.json",n=null)}a.cacheLanguageResolution&&(t=t)}return e+t}(e));return Array.isArray(b)?p(b):f(b.messages)&&f(b.keys)?p(b.messages):(console.error("String bundle '"+e+"' uses an unsupported format."),function(){return"File bundle has unsupported format. See console for details"})}catch(e){"ENOENT"!==e.code&&console.error("Failed to load single file bundle",e)}return console.error("Failed to load message bundle for file "+e),function(){return"Failed to load message bundle. See console for details."}}!function(e){e.file="file",e.bundle="bundle",e.both="both"}(o=t.MessageFormat||(t.MessageFormat={})),function(e){e.standalone="standalone",e.languagePack="languagePack"}(s=t.BundleFormat||(t.BundleFormat={})),function(e){e.is=function(e){var t=e;return t&&f(t.key)&&f(t.comment)}}(r||(r={})),function(){if(a={locale:void 0,language:void 0,languagePackSupport:!1,cacheLanguageResolution:!0,messageFormat:o.bundle},g(process.env.VSCODE_NLS_CONFIG))try{var e=JSON.parse(process.env.VSCODE_NLS_CONFIG),t=void 0;if(e.availableLanguages){var n=e.availableLanguages["*"];g(n)&&(t=n)}if(g(e.locale)&&(a.locale=e.locale.toLowerCase()),void 0===t?a.language=a.locale:"en"!==t&&(a.language=t),function(e){return!0===e||!1===e}(e._languagePackSupport)&&(a.languagePackSupport=e._languagePackSupport),g(e._cacheRoot)&&(a.cacheRoot=e._cacheRoot),g(e._languagePackId)&&(a.languagePackId=e._languagePackId),g(e._translationsConfigFile)){a.translationsConfigFile=e._translationsConfigFile;try{a.translationsConfig=h(a.translationsConfigFile)}catch(t){if(e._corruptedFile){var s=u.dirname(e._corruptedFile);l.exists(s,function(t){t&&l.writeFile(e._corruptedFile,"corrupted","utf8",function(e){console.error(e)})})}}}}catch(e){}c="pseudo"===a.locale,void 0,i=Object.create(null)}(),t.loadMessageBundle=w,t.config=function(e){return e&&(g(e.locale)&&(a.locale=e.locale.toLowerCase(),a.language=a.locale,void 0,i=Object.create(null)),void 0!==e.messageFormat&&(a.messageFormat=e.messageFormat),e.bundleFormat===s.standalone&&!0===a.languagePackSupport&&(a.languagePackSupport=!1)),c="pseudo"===a.locale,w}},function(e,t){e.exports=require("keytar")},function(e,t){e.exports=require("https")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseFromEvent=t.onceEvent=t.filterEvent=void 0,t.filterEvent=function(e,t){return(n,o=null,s)=>e(e=>t(e)&&n.call(o,e),null,s)},t.onceEvent=function(e){return(t,n=null,o)=>{const s=e(e=>(s.dispose(),t.call(n,e)),null,o);return s}};const o=(e,t)=>t(e);t.promiseFromEvent=async function(e,t=o){let n;return new Promise((o,s)=>n=e(e=>{try{Promise.resolve(t(e,o,s)).catch(s)}catch(e){s(e)}})).then(e=>(n.dispose(),e),e=>{throw n.dispose(),e})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Registrar=void 0;const o=n(0),s=n(6),r=n(2);class i{constructor(){try{const e=s.readFileSync(r.join(o.env.appRoot,"extensions/github-authentication/src/common/config.json")).toString();this._config=JSON.parse(e)}catch(e){this._config={OSS:{},INSIDERS:{},STABLE:{},EXPLORATION:{},VSO:{},VSO_PPE:{},VSO_DEV:{},GITHUB_APP:{}}}}getGitHubAppDetails(){if(!this._config.GITHUB_APP.id||!this._config.GITHUB_APP.secret)throw new Error("No GitHub App client configuration available");return this._config.GITHUB_APP}getClientDetails(e){let t;switch(e.scheme){case"code-oss":t=this._config.OSS;break;case"vscode-insiders":t=this._config.INSIDERS;break;case"vscode":t=this._config.STABLE;break;case"vscode-exploration":t=this._config.EXPLORATION;break;case"https":switch(e.authority){case"online.visualstudio.com":t=this._config.VSO;break;case"online-ppe.core.vsengsaas.visualstudio.com":t=this._config.VSO_PPE;break;case"online.dev.core.vsengsaas.visualstudio.com":t=this._config.VSO_DEV}default:throw new Error(`Unrecognized callback ${e}`)}if(!t.id||!t.secret)throw new Error(`No client configuration available for ${e}`);return t}}t.Registrar=i;const a=new i;t.default=a}]));
//# sourceMappingURL=https://ticino.blob.core.windows.net/sourcemaps/undefined/extensions/github-authentication/dist/extension.js.map