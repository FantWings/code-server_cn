{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"vscode\"","webpack:///external \"path\"","webpack:///external \"crypto\"","webpack:///./node_modules/uuid/lib/rng.js","webpack:///./node_modules/uuid/lib/bytesToUuid.js","webpack:///external \"fs\"","webpack:///./src/logger.ts","webpack:///./node_modules/vscode-nls/lib/main.js","webpack:///./src/extension.ts","webpack:///./src/AADHelper.ts","webpack:///external \"https\"","webpack:///external \"querystring\"","webpack:///./node_modules/uuid/index.js","webpack:///./node_modules/uuid/v1.js","webpack:///./node_modules/uuid/v4.js","webpack:///./src/authServer.ts","webpack:///external \"http\"","webpack:///external \"url\"","webpack:///./src/keychain.ts","webpack:///external \"keytar\"","webpack:///./src/utils.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","crypto","randomBytes","byteToHex","toString","substr","buf","offset","bth","join","vscode","Level","padLeft","pad","repeat","Math","max","length","Logger","[object Object]","this","output","window","createOutputChannel","level","workspace","getConfiguration","Info","onDidChangeConfiguration","e","affectsConfiguration","data","Error","stack","message","success","logLevel","Trace","appendLine","now","data2String","Date","getUTCHours","getMinutes","getUTCSeconds","getMilliseconds","default","MessageFormat","BundleFormat","LocalizeInfo","resolvedBundles","options","isPseudo","path","fs","isDefined","isString","readJsonFileSync","filename","JSON","parse","readFileSync","format","args","replace","match","rest","index","arg","replacement","String","createScopedLocalizeFunction","messages","_i","arguments","isNumber","console","error","warn","localize","cacheBundle","bundle","loadNlsBundleOrCreateFromI18n","header","bundlePath","result","cacheRoot","id","hash","useMemoryOnly","writeBundle","encoding","flag","file","utimes","touch","err","code","SyntaxError","log","unlink","metaDataPath","languagePackLocation","translationsConfig","languagePack","contents","metaData","module_2","entry","translations","outDir","resultMessages","keys","messageKey","translatedMessage","undefined","push","createNLSBundle","writeFileSync","stringify","loadDefaultNlsBundle","folder","module_1","createDefaultNlsBundle","loadNlsBundle","languagePackSupport","languagePackId","translationsConfigFile","candidate","root","language","existsSync","lastIndexOf","substring","findInTheBoxBundle","loadMessageBundle","ext","extname","messageFormat","both","headerFile","dirname","parent","tryFindMetaDataHeaderFile","nlsBundle","module_3","json","resolvedLanguage","cacheLanguageResolution","locale","resolveLanguage","Array","isArray","is","comment","process","env","VSCODE_NLS_CONFIG","vscodeOptions","availableLanguages","toLowerCase","isBoolean","_languagePackSupport","_cacheRoot","_languagePackId","_translationsConfigFile","_corruptedFile","writeFile","_a","initializeSettings","config","opts","bundleFormat","standalone","AADHelper_1","__dirname","DEFAULT_SCOPES","activate","async","context","loginService","AzureActiveDirectoryService","initialize","subscriptions","authentication","registerAuthenticationProvider","displayName","onDidChangeSessions","event","getSessions","Promise","resolve","sessions","login","scopes","sort","session","fire","added","removed","changed","logout","showInformationMessage","commands","registerCommand","selectedSession","showQuickPick","map","label","accountName","deactivate","https","querystring","uuid","authServer_1","keychain_1","logger_1","utils_1","redirectUrl","loginEndpointUrl","clientId","tenant","EventEmitter","REFRESH_NETWORK_FAILURE","UriEventHandler","uri","_tokens","_refreshTimeouts","Map","_uriHandler","registerUriHandler","storedData","keychain","getToken","refreshes","parseStoredData","refreshToken","scope","handleRefreshNetworkError","accessToken","sessionId","pollForReconnect","all","info","clearSessions","pollForChange","serializedData","token","setToken","setTimeout","addedIds","removedIds","promises","some","concat","forEach","timeout","clearTimeout","clear","getAccessToken","resolveAccessToken","split","expiresAt","refreshedToken","Buffer","from","convertToSession","uiKind","UIKind","Web","loginWithoutLocalServer","nonce","server","redirectPromise","codePromise","createServer","port","startServer","openExternal","Uri","encodeURIComponent","redirectReq","res","writeHead","Location","end","host","req","headers","updatedPortStr","exec","state","parseInt","codeVerifier","toBase64UrlEncoding","codeChallenge","createHash","update","digest","loginUrl","codeRes","exchangeCodeForToken","close","callbackUri","authority","asExternalUri","uriScheme","scheme","getCallbackEnvironment","query","signInUrl","with","timeoutPromise","_","reject","wait","race","handleCodeResponse","uriEventListener","reduce","prev","current","queryString","parseQuery","decodeURIComponent","then","dispose","catch","existingTokenIndex","findIndex","splice","clearSessionTimeout","expiresIn","set","storeTokenData","buffer","existingId","claims","getTokenClaims","access_token","expires_in","refresh_token","tid","oid","altsecid","ipd","email","unique_name","postData","grant_type","client_id","code_verifier","redirect_uri","tokenUrl","post","request","method","Content-Type","Content-Length","on","chunk","statusCode","getTokenFromResponse","write","delete","tokenIndex","attempts","find","delayBeforeRetry","removeInMemorySessionData","deleteToken","v1","v4","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","b","node","clockseq","seedBytes","msecs","getTime","nsecs","dt","tl","tmh","rnds","random","ii","http","url","_typeof","number","string","function","isUndefined","obj","isUndefinedOrNull","assertIsDefined","sendFile","filepath","contentType","readFile","body","createTerminateServer","sockets","socketCount","socket","destroy","portTimer","cancelPortTimer","address","listen","deferredRedirect","deferredCode","codeTimer","cancelCodeTimer","reqUrl","pathname","error_description","callback","SERVICE_ID","ACCOUNT_ID","Keychain","keytar","getKeytar","trace","setPassword","troubleshooting","showErrorMessage","getPassword","deletePassword","base64string"],"mappings":"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","file":"extension.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","module.exports = require(\"vscode\");","module.exports = require(\"path\");","module.exports = require(\"crypto\");","// Unique ID creation requires a high quality random # generator.  In node.js\n// this is pretty straight-forward - we use the crypto API.\n\nvar crypto = require('crypto');\n\nmodule.exports = function nodeRNG() {\n  return crypto.randomBytes(16);\n};\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]]\n  ]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","module.exports = require(\"fs\");","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\n\ntype LogLevel = 'Trace' | 'Info' | 'Error';\n\nenum Level {\n\tTrace = 'trace',\n\tInfo = 'Info'\n}\n\nclass Log {\n\tprivate output: vscode.OutputChannel;\n\tprivate level: Level;\n\n\tconstructor() {\n\t\tthis.output = vscode.window.createOutputChannel('Account');\n\t\tthis.level = vscode.workspace.getConfiguration('microsoftAccount').get('logLevel') || Level.Info;\n\t\tvscode.workspace.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('microsoftAccount.logLevel')) {\n\t\t\t\tthis.level = vscode.workspace.getConfiguration('microsoftAccount').get('logLevel') || Level.Info;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate data2String(data: any): string {\n\t\tif (data instanceof Error) {\n\t\t\treturn data.stack || data.message;\n\t\t}\n\t\tif (data.success === false && data.message) {\n\t\t\treturn data.message;\n\t\t}\n\t\treturn data.toString();\n\t}\n\n\tpublic info(message: string, data?: any): void {\n\t\tthis.logLevel('Info', message, data);\n\t}\n\n\tpublic error(message: string, data?: any): void {\n\t\tthis.logLevel('Error', message, data);\n\t}\n\n\tpublic trace(message: string, data?: any): void {\n\t\tif (this.level === Level.Trace) {\n\t\t\tthis.logLevel('Trace', message, data);\n\t\t}\n\t}\n\n\tpublic logLevel(level: LogLevel, message: string, data?: any): void {\n\t\tthis.output.appendLine(`[${level}  - ${this.now()}] ${message}`);\n\t\tif (data) {\n\t\t\tthis.output.appendLine(this.data2String(data));\n\t\t}\n\t}\n\n\tprivate now(): string {\n\t\tconst now = new Date();\n\t\treturn padLeft(now.getUTCHours() + '', 2, '0')\n\t\t\t+ ':' + padLeft(now.getMinutes() + '', 2, '0')\n\t\t\t+ ':' + padLeft(now.getUTCSeconds() + '', 2, '0') + '.' + now.getMilliseconds();\n\t}\n}\n\nfunction padLeft(s: string, n: number, pad = ' ') {\n\treturn pad.repeat(Math.max(0, n - s.length)) + s;\n}\n\nconst Logger = new Log();\nexport default Logger;\n","/* --------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License. See License.txt in the project root for license information.\r\n * ------------------------------------------------------------------------------------------ */\r\n'use strict';\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar path = require(\"path\");\r\nvar fs = require(\"fs\");\r\nvar toString = Object.prototype.toString;\r\nfunction isDefined(value) {\r\n    return typeof value !== 'undefined';\r\n}\r\nfunction isNumber(value) {\r\n    return toString.call(value) === '[object Number]';\r\n}\r\nfunction isString(value) {\r\n    return toString.call(value) === '[object String]';\r\n}\r\nfunction isBoolean(value) {\r\n    return value === true || value === false;\r\n}\r\nfunction readJsonFileSync(filename) {\r\n    return JSON.parse(fs.readFileSync(filename, 'utf8'));\r\n}\r\nvar MessageFormat;\r\n(function (MessageFormat) {\r\n    MessageFormat[\"file\"] = \"file\";\r\n    MessageFormat[\"bundle\"] = \"bundle\";\r\n    MessageFormat[\"both\"] = \"both\";\r\n})(MessageFormat = exports.MessageFormat || (exports.MessageFormat = {}));\r\nvar BundleFormat;\r\n(function (BundleFormat) {\r\n    // the nls.bundle format\r\n    BundleFormat[\"standalone\"] = \"standalone\";\r\n    BundleFormat[\"languagePack\"] = \"languagePack\";\r\n})(BundleFormat = exports.BundleFormat || (exports.BundleFormat = {}));\r\nvar LocalizeInfo;\r\n(function (LocalizeInfo) {\r\n    function is(value) {\r\n        var candidate = value;\r\n        return candidate && isDefined(candidate.key) && isDefined(candidate.comment);\r\n    }\r\n    LocalizeInfo.is = is;\r\n})(LocalizeInfo || (LocalizeInfo = {}));\r\nvar resolvedLanguage;\r\nvar resolvedBundles;\r\nvar options;\r\nvar isPseudo;\r\nfunction initializeSettings() {\r\n    options = { locale: undefined, language: undefined, languagePackSupport: false, cacheLanguageResolution: true, messageFormat: MessageFormat.bundle };\r\n    if (isString(process.env.VSCODE_NLS_CONFIG)) {\r\n        try {\r\n            var vscodeOptions = JSON.parse(process.env.VSCODE_NLS_CONFIG);\r\n            var language = void 0;\r\n            var locale = void 0;\r\n            if (vscodeOptions.availableLanguages) {\r\n                var value = vscodeOptions.availableLanguages['*'];\r\n                if (isString(value)) {\r\n                    language = value;\r\n                }\r\n            }\r\n            if (isString(vscodeOptions.locale)) {\r\n                options.locale = vscodeOptions.locale.toLowerCase();\r\n            }\r\n            if (language === undefined) {\r\n                options.language = options.locale;\r\n            }\r\n            else if (language !== 'en') {\r\n                options.language = language;\r\n            }\r\n            if (isBoolean(vscodeOptions._languagePackSupport)) {\r\n                options.languagePackSupport = vscodeOptions._languagePackSupport;\r\n            }\r\n            if (isString(vscodeOptions._cacheRoot)) {\r\n                options.cacheRoot = vscodeOptions._cacheRoot;\r\n            }\r\n            if (isString(vscodeOptions._languagePackId)) {\r\n                options.languagePackId = vscodeOptions._languagePackId;\r\n            }\r\n            if (isString(vscodeOptions._translationsConfigFile)) {\r\n                options.translationsConfigFile = vscodeOptions._translationsConfigFile;\r\n                try {\r\n                    options.translationsConfig = readJsonFileSync(options.translationsConfigFile);\r\n                }\r\n                catch (error) {\r\n                    // We can't read the translation config file. Mark the cache as corrupted.\r\n                    if (vscodeOptions._corruptedFile) {\r\n                        fs.writeFile(vscodeOptions._corruptedFile, 'corrupted', 'utf8', function (err) {\r\n                            console.error(err);\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        catch (_a) {\r\n            // Do nothing.\r\n        }\r\n    }\r\n    isPseudo = options.locale === 'pseudo';\r\n    resolvedLanguage = undefined;\r\n    resolvedBundles = Object.create(null);\r\n}\r\ninitializeSettings();\r\nfunction supportsLanguagePack() {\r\n    return options.languagePackSupport === true && options.cacheRoot !== undefined && options.languagePackId !== undefined && options.translationsConfigFile !== undefined\r\n        && options.translationsConfig !== undefined;\r\n}\r\nfunction format(message, args) {\r\n    var result;\r\n    if (isPseudo) {\r\n        // FF3B and FF3D is the Unicode zenkaku representation for [ and ]\r\n        message = '\\uFF3B' + message.replace(/[aouei]/g, '$&$&') + '\\uFF3D';\r\n    }\r\n    if (args.length === 0) {\r\n        result = message;\r\n    }\r\n    else {\r\n        result = message.replace(/\\{(\\d+)\\}/g, function (match, rest) {\r\n            var index = rest[0];\r\n            var arg = args[index];\r\n            var replacement = match;\r\n            if (typeof arg === 'string') {\r\n                replacement = arg;\r\n            }\r\n            else if (typeof arg === 'number' || typeof arg === 'boolean' || arg === void 0 || arg === null) {\r\n                replacement = String(arg);\r\n            }\r\n            return replacement;\r\n        });\r\n    }\r\n    return result;\r\n}\r\nfunction createScopedLocalizeFunction(messages) {\r\n    return function (key, message) {\r\n        var args = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            args[_i - 2] = arguments[_i];\r\n        }\r\n        if (isNumber(key)) {\r\n            if (key >= messages.length) {\r\n                console.error(\"Broken localize call found. Index out of bounds. Stacktrace is\\n: \" + new Error('').stack);\r\n                return;\r\n            }\r\n            return format(messages[key], args);\r\n        }\r\n        else {\r\n            if (isString(message)) {\r\n                console.warn(\"Message \" + message + \" didn't get externalized correctly.\");\r\n                return format(message, args);\r\n            }\r\n            else {\r\n                console.error(\"Broken localize call found. Stacktrace is\\n: \" + new Error('').stack);\r\n            }\r\n        }\r\n    };\r\n}\r\nfunction localize(key, message) {\r\n    var args = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        args[_i - 2] = arguments[_i];\r\n    }\r\n    return format(message, args);\r\n}\r\nfunction resolveLanguage(file) {\r\n    var resolvedLanguage;\r\n    if (options.cacheLanguageResolution && resolvedLanguage) {\r\n        resolvedLanguage = resolvedLanguage;\r\n    }\r\n    else {\r\n        if (isPseudo || !options.language) {\r\n            resolvedLanguage = '.nls.json';\r\n        }\r\n        else {\r\n            var locale = options.language;\r\n            while (locale) {\r\n                var candidate = '.nls.' + locale + '.json';\r\n                if (fs.existsSync(file + candidate)) {\r\n                    resolvedLanguage = candidate;\r\n                    break;\r\n                }\r\n                else {\r\n                    var index = locale.lastIndexOf('-');\r\n                    if (index > 0) {\r\n                        locale = locale.substring(0, index);\r\n                    }\r\n                    else {\r\n                        resolvedLanguage = '.nls.json';\r\n                        locale = null;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (options.cacheLanguageResolution) {\r\n            resolvedLanguage = resolvedLanguage;\r\n        }\r\n    }\r\n    return file + resolvedLanguage;\r\n}\r\nfunction findInTheBoxBundle(root) {\r\n    var language = options.language;\r\n    while (language) {\r\n        var candidate = path.join(root, \"nls.bundle.\" + language + \".json\");\r\n        if (fs.existsSync(candidate)) {\r\n            return candidate;\r\n        }\r\n        else {\r\n            var index = language.lastIndexOf('-');\r\n            if (index > 0) {\r\n                language = language.substring(0, index);\r\n            }\r\n            else {\r\n                language = undefined;\r\n            }\r\n        }\r\n    }\r\n    // Test if we can reslove the default bundle.\r\n    if (language === undefined) {\r\n        var candidate = path.join(root, 'nls.bundle.json');\r\n        if (fs.existsSync(candidate)) {\r\n            return candidate;\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\nfunction mkdir(directory) {\r\n    try {\r\n        fs.mkdirSync(directory);\r\n    }\r\n    catch (err) {\r\n        if (err.code === 'EEXIST') {\r\n            return;\r\n        }\r\n        else if (err.code === 'ENOENT') {\r\n            var parent = path.dirname(directory);\r\n            if (parent !== directory) {\r\n                mkdir(parent);\r\n                fs.mkdirSync(directory);\r\n            }\r\n        }\r\n        else {\r\n            throw err;\r\n        }\r\n    }\r\n}\r\nfunction createDefaultNlsBundle(folder) {\r\n    var metaData = readJsonFileSync(path.join(folder, 'nls.metadata.json'));\r\n    var result = Object.create(null);\r\n    for (var module_1 in metaData) {\r\n        var entry = metaData[module_1];\r\n        result[module_1] = entry.messages;\r\n    }\r\n    return result;\r\n}\r\nfunction createNLSBundle(header, metaDataPath) {\r\n    var languagePackLocation = options.translationsConfig[header.id];\r\n    if (!languagePackLocation) {\r\n        return undefined;\r\n    }\r\n    var languagePack = readJsonFileSync(languagePackLocation).contents;\r\n    var metaData = readJsonFileSync(path.join(metaDataPath, 'nls.metadata.json'));\r\n    var result = Object.create(null);\r\n    for (var module_2 in metaData) {\r\n        var entry = metaData[module_2];\r\n        var translations = languagePack[header.outDir + \"/\" + module_2];\r\n        if (translations) {\r\n            var resultMessages = [];\r\n            for (var i = 0; i < entry.keys.length; i++) {\r\n                var messageKey = entry.keys[i];\r\n                var key = isString(messageKey) ? messageKey : messageKey.key;\r\n                var translatedMessage = translations[key];\r\n                if (translatedMessage === undefined) {\r\n                    translatedMessage = entry.messages[i];\r\n                }\r\n                resultMessages.push(translatedMessage);\r\n            }\r\n            result[module_2] = resultMessages;\r\n        }\r\n        else {\r\n            result[module_2] = entry.messages;\r\n        }\r\n    }\r\n    return result;\r\n}\r\nfunction touch(file) {\r\n    var d = new Date();\r\n    fs.utimes(file, d, d, function () {\r\n        // Do nothing. Ignore\r\n    });\r\n}\r\nfunction cacheBundle(key, bundle) {\r\n    resolvedBundles[key] = bundle;\r\n    return bundle;\r\n}\r\nfunction loadNlsBundleOrCreateFromI18n(header, bundlePath) {\r\n    var result;\r\n    var bundle = path.join(options.cacheRoot, header.id + \"-\" + header.hash + \".json\");\r\n    var useMemoryOnly = false;\r\n    var writeBundle = false;\r\n    try {\r\n        result = JSON.parse(fs.readFileSync(bundle, { encoding: 'utf8', flag: 'r' }));\r\n        touch(bundle);\r\n        return result;\r\n    }\r\n    catch (err) {\r\n        if (err.code === 'ENOENT') {\r\n            writeBundle = true;\r\n        }\r\n        else if (err instanceof SyntaxError) {\r\n            // We have a syntax error. So no valid JSON. Use\r\n            console.log(\"Syntax error parsing message bundle: \" + err.message + \".\");\r\n            fs.unlink(bundle, function (err) {\r\n                if (err) {\r\n                    console.error(\"Deleting corrupted bundle \" + bundle + \" failed.\");\r\n                }\r\n            });\r\n            useMemoryOnly = true;\r\n        }\r\n        else {\r\n            throw err;\r\n        }\r\n    }\r\n    result = createNLSBundle(header, bundlePath);\r\n    if (!result || useMemoryOnly) {\r\n        return result;\r\n    }\r\n    if (writeBundle) {\r\n        try {\r\n            fs.writeFileSync(bundle, JSON.stringify(result), { encoding: 'utf8', flag: 'wx' });\r\n        }\r\n        catch (err) {\r\n            if (err.code === 'EEXIST') {\r\n                return result;\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n    return result;\r\n}\r\nfunction loadDefaultNlsBundle(bundlePath) {\r\n    try {\r\n        return createDefaultNlsBundle(bundlePath);\r\n    }\r\n    catch (err) {\r\n        console.log(\"Generating default bundle from meta data failed.\", err);\r\n        return undefined;\r\n    }\r\n}\r\nfunction loadNlsBundle(header, bundlePath) {\r\n    var result;\r\n    // Core decided to use a language pack. Do the same in the extension\r\n    if (supportsLanguagePack()) {\r\n        try {\r\n            result = loadNlsBundleOrCreateFromI18n(header, bundlePath);\r\n        }\r\n        catch (err) {\r\n            console.log(\"Load or create bundle failed \", err);\r\n        }\r\n    }\r\n    if (!result) {\r\n        // No language pack found, but core is running in language pack mode\r\n        // Don't try to use old in the box bundles since the might be stale\r\n        // Fall right back to the default bundle.\r\n        if (options.languagePackSupport) {\r\n            return loadDefaultNlsBundle(bundlePath);\r\n        }\r\n        var candidate = findInTheBoxBundle(bundlePath);\r\n        if (candidate) {\r\n            try {\r\n                return readJsonFileSync(candidate);\r\n            }\r\n            catch (err) {\r\n                console.log(\"Loading in the box message bundle failed.\", err);\r\n            }\r\n        }\r\n        result = loadDefaultNlsBundle(bundlePath);\r\n    }\r\n    return result;\r\n}\r\nfunction tryFindMetaDataHeaderFile(file) {\r\n    var result;\r\n    var dirname = path.dirname(file);\r\n    while (true) {\r\n        result = path.join(dirname, 'nls.metadata.header.json');\r\n        if (fs.existsSync(result)) {\r\n            break;\r\n        }\r\n        var parent = path.dirname(dirname);\r\n        if (parent === dirname) {\r\n            result = undefined;\r\n            break;\r\n        }\r\n        else {\r\n            dirname = parent;\r\n        }\r\n    }\r\n    return result;\r\n}\r\nfunction loadMessageBundle(file) {\r\n    if (!file) {\r\n        // No file. We are in dev mode. Return the default\r\n        // localize function.\r\n        return localize;\r\n    }\r\n    // Remove extension since we load json files.\r\n    var ext = path.extname(file);\r\n    if (ext) {\r\n        file = file.substr(0, file.length - ext.length);\r\n    }\r\n    if (options.messageFormat === MessageFormat.both || options.messageFormat === MessageFormat.bundle) {\r\n        var headerFile = tryFindMetaDataHeaderFile(file);\r\n        if (headerFile) {\r\n            var bundlePath = path.dirname(headerFile);\r\n            var bundle = resolvedBundles[bundlePath];\r\n            if (bundle === undefined) {\r\n                try {\r\n                    var header = JSON.parse(fs.readFileSync(headerFile, 'utf8'));\r\n                    try {\r\n                        var nlsBundle = loadNlsBundle(header, bundlePath);\r\n                        bundle = cacheBundle(bundlePath, nlsBundle ? { header: header, nlsBundle: nlsBundle } : null);\r\n                    }\r\n                    catch (err) {\r\n                        console.error('Failed to load nls bundle', err);\r\n                        bundle = cacheBundle(bundlePath, null);\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    console.error('Failed to read header file', err);\r\n                    bundle = cacheBundle(bundlePath, null);\r\n                }\r\n            }\r\n            if (bundle) {\r\n                var module_3 = file.substr(bundlePath.length + 1).replace(/\\\\/g, '/');\r\n                var messages = bundle.nlsBundle[module_3];\r\n                if (messages === undefined) {\r\n                    console.error(\"Messages for file \" + file + \" not found. See console for details.\");\r\n                    return function () {\r\n                        return 'Messages not found.';\r\n                    };\r\n                }\r\n                return createScopedLocalizeFunction(messages);\r\n            }\r\n        }\r\n    }\r\n    if (options.messageFormat === MessageFormat.both || options.messageFormat === MessageFormat.file) {\r\n        // Try to load a single file bundle\r\n        try {\r\n            var json = readJsonFileSync(resolveLanguage(file));\r\n            if (Array.isArray(json)) {\r\n                return createScopedLocalizeFunction(json);\r\n            }\r\n            else {\r\n                if (isDefined(json.messages) && isDefined(json.keys)) {\r\n                    return createScopedLocalizeFunction(json.messages);\r\n                }\r\n                else {\r\n                    console.error(\"String bundle '\" + file + \"' uses an unsupported format.\");\r\n                    return function () {\r\n                        return 'File bundle has unsupported format. See console for details';\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        catch (err) {\r\n            if (err.code !== 'ENOENT') {\r\n                console.error('Failed to load single file bundle', err);\r\n            }\r\n        }\r\n    }\r\n    console.error(\"Failed to load message bundle for file \" + file);\r\n    return function () {\r\n        return 'Failed to load message bundle. See console for details.';\r\n    };\r\n}\r\nexports.loadMessageBundle = loadMessageBundle;\r\nfunction config(opts) {\r\n    if (opts) {\r\n        if (isString(opts.locale)) {\r\n            options.locale = opts.locale.toLowerCase();\r\n            options.language = options.locale;\r\n            resolvedLanguage = undefined;\r\n            resolvedBundles = Object.create(null);\r\n        }\r\n        if (opts.messageFormat !== undefined) {\r\n            options.messageFormat = opts.messageFormat;\r\n        }\r\n        if (opts.bundleFormat === BundleFormat.standalone && options.languagePackSupport === true) {\r\n            options.languagePackSupport = false;\r\n        }\r\n    }\r\n    isPseudo = options.locale === 'pseudo';\r\n    return loadMessageBundle;\r\n}\r\nexports.config = config;\r\n//# sourceMappingURL=main.js.map",null,"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as crypto from 'crypto';\nimport * as https from 'https';\nimport * as querystring from 'querystring';\nimport * as vscode from 'vscode';\nimport * as uuid from 'uuid';\nimport { createServer, startServer } from './authServer';\nimport { keychain } from './keychain';\nimport Logger from './logger';\nimport { toBase64UrlEncoding } from './utils';\n\nconst redirectUrl = 'https://vscode-redirect.azurewebsites.net/';\nconst loginEndpointUrl = 'https://login.microsoftonline.com/';\nconst clientId = 'aebc6443-996d-45c2-90f0-388ff96faa56';\nconst tenant = 'organizations';\n\ninterface IToken {\n\taccessToken?: string; // When unable to refresh due to network problems, the access token becomes undefined\n\n\texpiresIn?: string; // How long access token is valid, in seconds\n\texpiresAt?: number; // UNIX epoch time at which token will expire\n\trefreshToken: string;\n\n\taccountName: string;\n\tscope: string;\n\tsessionId: string; // The account id + the scope\n}\n\ninterface ITokenClaims {\n\ttid: string;\n\temail?: string;\n\tunique_name?: string;\n\toid?: string;\n\taltsecid?: string;\n\tipd?: string;\n\tscp: string;\n}\n\ninterface IStoredSession {\n\tid: string;\n\trefreshToken: string;\n\tscope: string; // Scopes are alphabetized and joined with a space\n\taccountName: string;\n}\n\nfunction parseQuery(uri: vscode.Uri) {\n\treturn uri.query.split('&').reduce((prev: any, current) => {\n\t\tconst queryString = current.split('=');\n\t\tprev[queryString[0]] = queryString[1];\n\t\treturn prev;\n\t}, {});\n}\n\nexport const onDidChangeSessions = new vscode.EventEmitter<vscode.AuthenticationSessionsChangeEvent>();\n\nexport const REFRESH_NETWORK_FAILURE = 'Network failure';\n\nclass UriEventHandler extends vscode.EventEmitter<vscode.Uri> implements vscode.UriHandler {\n\tpublic handleUri(uri: vscode.Uri) {\n\t\tthis.fire(uri);\n\t}\n}\n\nexport class AzureActiveDirectoryService {\n\tprivate _tokens: IToken[] = [];\n\tprivate _refreshTimeouts: Map<string, NodeJS.Timeout> = new Map<string, NodeJS.Timeout>();\n\tprivate _uriHandler: UriEventHandler;\n\n\tconstructor() {\n\t\tthis._uriHandler = new UriEventHandler();\n\t\tvscode.window.registerUriHandler(this._uriHandler);\n\t}\n\n\tpublic async initialize(): Promise<void> {\n\t\tconst storedData = await keychain.getToken();\n\t\tif (storedData) {\n\t\t\ttry {\n\t\t\t\tconst sessions = this.parseStoredData(storedData);\n\t\t\t\tconst refreshes = sessions.map(async session => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.refreshToken(session.refreshToken, session.scope, session.id);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tif (e.message === REFRESH_NETWORK_FAILURE) {\n\t\t\t\t\t\t\tconst didSucceedOnRetry = await this.handleRefreshNetworkError(session.id, session.refreshToken, session.scope);\n\t\t\t\t\t\t\tif (!didSucceedOnRetry) {\n\t\t\t\t\t\t\t\tthis._tokens.push({\n\t\t\t\t\t\t\t\t\taccessToken: undefined,\n\t\t\t\t\t\t\t\t\trefreshToken: session.refreshToken,\n\t\t\t\t\t\t\t\t\taccountName: session.accountName,\n\t\t\t\t\t\t\t\t\tscope: session.scope,\n\t\t\t\t\t\t\t\t\tsessionId: session.id\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.pollForReconnect(session.id, session.refreshToken, session.scope);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait this.logout(session.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tawait Promise.all(refreshes);\n\t\t\t} catch (e) {\n\t\t\t\tLogger.info('Failed to initialize stored data');\n\t\t\t\tawait this.clearSessions();\n\t\t\t}\n\t\t}\n\n\t\tthis.pollForChange();\n\t}\n\n\tprivate parseStoredData(data: string): IStoredSession[] {\n\t\treturn JSON.parse(data);\n\t}\n\n\tprivate async storeTokenData(): Promise<void> {\n\t\tconst serializedData: IStoredSession[] = this._tokens.map(token => {\n\t\t\treturn {\n\t\t\t\tid: token.sessionId,\n\t\t\t\trefreshToken: token.refreshToken,\n\t\t\t\tscope: token.scope,\n\t\t\t\taccountName: token.accountName\n\t\t\t};\n\t\t});\n\n\t\tawait keychain.setToken(JSON.stringify(serializedData));\n\t}\n\n\tprivate pollForChange() {\n\t\tsetTimeout(async () => {\n\t\t\tconst addedIds: string[] = [];\n\t\t\tlet removedIds: string[] = [];\n\t\t\tconst storedData = await keychain.getToken();\n\t\t\tif (storedData) {\n\t\t\t\ttry {\n\t\t\t\t\tconst sessions = this.parseStoredData(storedData);\n\t\t\t\t\tlet promises = sessions.map(async session => {\n\t\t\t\t\t\tconst matchesExisting = this._tokens.some(token => token.scope === session.scope && token.sessionId === session.id);\n\t\t\t\t\t\tif (!matchesExisting) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tawait this.refreshToken(session.refreshToken, session.scope, session.id);\n\t\t\t\t\t\t\t\taddedIds.push(session.id);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tif (e.message === REFRESH_NETWORK_FAILURE) {\n\t\t\t\t\t\t\t\t\t// Ignore, will automatically retry on next poll.\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tawait this.logout(session.id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tpromises = promises.concat(this._tokens.map(async token => {\n\t\t\t\t\t\tconst matchesExisting = sessions.some(session => token.scope === session.scope && token.sessionId === session.id);\n\t\t\t\t\t\tif (!matchesExisting) {\n\t\t\t\t\t\t\tawait this.logout(token.sessionId);\n\t\t\t\t\t\t\tremovedIds.push(token.sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\n\t\t\t\t\tawait Promise.all(promises);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tLogger.error(e.message);\n\t\t\t\t\t// if data is improperly formatted, remove all of it and send change event\n\t\t\t\t\tremovedIds = this._tokens.map(token => token.sessionId);\n\t\t\t\t\tthis.clearSessions();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._tokens.length) {\n\t\t\t\t\t// Log out all, remove all local data\n\t\t\t\t\tremovedIds = this._tokens.map(token => token.sessionId);\n\t\t\t\t\tLogger.info('No stored keychain data, clearing local data');\n\n\t\t\t\t\tthis._tokens = [];\n\n\t\t\t\t\tthis._refreshTimeouts.forEach(timeout => {\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._refreshTimeouts.clear();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (addedIds.length || removedIds.length) {\n\t\t\t\tonDidChangeSessions.fire({ added: addedIds, removed: removedIds, changed: [] });\n\t\t\t}\n\n\t\t\tthis.pollForChange();\n\t\t}, 1000 * 30);\n\t}\n\n\tprivate convertToSession(token: IToken): vscode.AuthenticationSession {\n\t\treturn {\n\t\t\tid: token.sessionId,\n\t\t\tgetAccessToken: () => this.resolveAccessToken(token),\n\t\t\taccountName: token.accountName,\n\t\t\tscopes: token.scope.split(' ')\n\t\t};\n\t}\n\n\tprivate async resolveAccessToken(token: IToken): Promise<string> {\n\t\tif (token.accessToken && (!token.expiresAt || token.expiresAt > Date.now())) {\n\t\t\ttoken.expiresAt\n\t\t\t\t? Logger.info(`Token available from cache, expires in ${token.expiresAt - Date.now()} milliseconds`)\n\t\t\t\t: Logger.info('Token available from cache');\n\t\t\treturn Promise.resolve(token.accessToken);\n\t\t}\n\n\t\ttry {\n\t\t\tLogger.info('Token expired or unavailable, trying refresh');\n\t\t\tconst refreshedToken = await this.refreshToken(token.refreshToken, token.scope, token.sessionId);\n\t\t\tif (refreshedToken.accessToken) {\n\t\t\t\treturn refreshedToken.accessToken;\n\t\t\t} else {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthrow new Error('Unavailable due to network problems');\n\t\t}\n\n\t\tthrow new Error('Unavailable due to network problems');\n\t}\n\n\tprivate getTokenClaims(accessToken: string): ITokenClaims {\n\t\ttry {\n\t\t\treturn JSON.parse(Buffer.from(accessToken.split('.')[1], 'base64').toString());\n\t\t} catch (e) {\n\t\t\tLogger.error(e.message);\n\t\t\tthrow new Error('Unable to read token claims');\n\t\t}\n\t}\n\n\tget sessions(): vscode.AuthenticationSession[] {\n\t\treturn this._tokens.map(token => this.convertToSession(token));\n\t}\n\n\tpublic async login(scope: string): Promise<void> {\n\t\tLogger.info('Logging in...');\n\n\t\tif (vscode.env.uiKind === vscode.UIKind.Web) {\n\t\t\tawait this.loginWithoutLocalServer(scope);\n\t\t\treturn;\n\t\t}\n\n\t\tconst nonce = crypto.randomBytes(16).toString('base64');\n\t\tconst { server, redirectPromise, codePromise } = createServer(nonce);\n\n\t\tlet token: IToken | undefined;\n\t\ttry {\n\t\t\tconst port = await startServer(server);\n\t\t\tvscode.env.openExternal(vscode.Uri.parse(`http://localhost:${port}/signin?nonce=${encodeURIComponent(nonce)}`));\n\n\t\t\tconst redirectReq = await redirectPromise;\n\t\t\tif ('err' in redirectReq) {\n\t\t\t\tconst { err, res } = redirectReq;\n\t\t\t\tres.writeHead(302, { Location: `/?error=${encodeURIComponent(err && err.message || 'Unknown error')}` });\n\t\t\t\tres.end();\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\tconst host = redirectReq.req.headers.host || '';\n\t\t\tconst updatedPortStr = (/^[^:]+:(\\d+)$/.exec(Array.isArray(host) ? host[0] : host) || [])[1];\n\t\t\tconst updatedPort = updatedPortStr ? parseInt(updatedPortStr, 10) : port;\n\n\t\t\tconst state = `${updatedPort},${encodeURIComponent(nonce)}`;\n\n\t\t\tconst codeVerifier = toBase64UrlEncoding(crypto.randomBytes(32).toString('base64'));\n\t\t\tconst codeChallenge = toBase64UrlEncoding(crypto.createHash('sha256').update(codeVerifier).digest('base64'));\n\t\t\tconst loginUrl = `${loginEndpointUrl}${tenant}/oauth2/v2.0/authorize?response_type=code&response_mode=query&client_id=${encodeURIComponent(clientId)}&redirect_uri=${encodeURIComponent(redirectUrl)}&state=${state}&scope=${encodeURIComponent(scope)}&prompt=select_account&code_challenge_method=S256&code_challenge=${codeChallenge}`;\n\n\t\t\tawait redirectReq.res.writeHead(302, { Location: loginUrl });\n\t\t\tredirectReq.res.end();\n\n\t\t\tconst codeRes = await codePromise;\n\t\t\tconst res = codeRes.res;\n\n\t\t\ttry {\n\t\t\t\tif ('err' in codeRes) {\n\t\t\t\t\tthrow codeRes.err;\n\t\t\t\t}\n\t\t\t\ttoken = await this.exchangeCodeForToken(codeRes.code, codeVerifier, scope);\n\t\t\t\tthis.setToken(token, scope);\n\t\t\t\tLogger.info('Login successful');\n\t\t\t\tres.writeHead(302, { Location: '/' });\n\t\t\t\tres.end();\n\t\t\t} catch (err) {\n\t\t\t\tres.writeHead(302, { Location: `/?error=${encodeURIComponent(err && err.message || 'Unknown error')}` });\n\t\t\t\tres.end();\n\t\t\t\tthrow new Error(err.message);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tLogger.error(e.message);\n\n\t\t\t// If the error was about starting the server, try directly hitting the login endpoint instead\n\t\t\tif (e.message === 'Error listening to server' || e.message === 'Closed' || e.message === 'Timeout waiting for port') {\n\t\t\t\tawait this.loginWithoutLocalServer(scope);\n\t\t\t}\n\t\t\tthrow new Error(e.message);\n\t\t} finally {\n\t\t\tsetTimeout(() => {\n\t\t\t\tserver.close();\n\t\t\t}, 5000);\n\t\t}\n\t}\n\n\tprivate getCallbackEnvironment(callbackUri: vscode.Uri): string {\n\t\tswitch (callbackUri.authority) {\n\t\t\tcase 'online.visualstudio.com':\n\t\t\t\treturn 'vso,';\n\t\t\tcase 'online-ppe.core.vsengsaas.visualstudio.com':\n\t\t\t\treturn 'vsoppe,';\n\t\t\tcase 'online.dev.core.vsengsaas.visualstudio.com':\n\t\t\t\treturn 'vsodev,';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\n\tprivate async loginWithoutLocalServer(scope: string): Promise<IToken> {\n\t\tconst callbackUri = await vscode.env.asExternalUri(vscode.Uri.parse(`${vscode.env.uriScheme}://vscode.vscode-account`));\n\t\tconst nonce = crypto.randomBytes(16).toString('base64');\n\t\tconst port = (callbackUri.authority.match(/:([0-9]*)$/) || [])[1] || (callbackUri.scheme === 'https' ? 443 : 80);\n\t\tconst callbackEnvironment = this.getCallbackEnvironment(callbackUri);\n\t\tconst state = `${callbackEnvironment}${port},${encodeURIComponent(nonce)},${encodeURIComponent(callbackUri.query)}`;\n\t\tconst signInUrl = `${loginEndpointUrl}${tenant}/oauth2/v2.0/authorize`;\n\t\tlet uri = vscode.Uri.parse(signInUrl);\n\t\tconst codeVerifier = toBase64UrlEncoding(crypto.randomBytes(32).toString('base64'));\n\t\tconst codeChallenge = toBase64UrlEncoding(crypto.createHash('sha256').update(codeVerifier).digest('base64'));\n\t\turi = uri.with({\n\t\t\tquery: `response_type=code&client_id=${encodeURIComponent(clientId)}&response_mode=query&redirect_uri=${redirectUrl}&state=${state}&scope=${scope}&prompt=select_account&code_challenge_method=S256&code_challenge=${codeChallenge}`\n\t\t});\n\t\tvscode.env.openExternal(uri);\n\n\t\tconst timeoutPromise = new Promise((_: (value: IToken) => void, reject) => {\n\t\t\tconst wait = setTimeout(() => {\n\t\t\t\tclearTimeout(wait);\n\t\t\t\treject('Login timed out.');\n\t\t\t}, 1000 * 60 * 5);\n\t\t});\n\n\t\treturn Promise.race([this.handleCodeResponse(state, codeVerifier, scope), timeoutPromise]);\n\t}\n\n\tprivate async handleCodeResponse(state: string, codeVerifier: string, scope: string) {\n\t\tlet uriEventListener: vscode.Disposable;\n\t\treturn new Promise((resolve: (value: IToken) => void, reject) => {\n\t\t\turiEventListener = this._uriHandler.event(async (uri: vscode.Uri) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst query = parseQuery(uri);\n\t\t\t\t\tconst code = query.code;\n\n\t\t\t\t\t// Workaround double encoding issues of state in web\n\t\t\t\t\tif (query.state !== state && decodeURIComponent(query.state) !== state) {\n\t\t\t\t\t\tthrow new Error('State does not match.');\n\t\t\t\t\t}\n\n\t\t\t\t\tconst token = await this.exchangeCodeForToken(code, codeVerifier, scope);\n\t\t\t\t\tthis.setToken(token, scope);\n\n\t\t\t\t\tresolve(token);\n\t\t\t\t} catch (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t}).then(result => {\n\t\t\turiEventListener.dispose();\n\t\t\treturn result;\n\t\t}).catch(err => {\n\t\t\turiEventListener.dispose();\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\tprivate async setToken(token: IToken, scope: string): Promise<void> {\n\t\tconst existingTokenIndex = this._tokens.findIndex(t => t.sessionId === token.sessionId);\n\t\tif (existingTokenIndex > -1) {\n\t\t\tthis._tokens.splice(existingTokenIndex, 1, token);\n\t\t} else {\n\t\t\tthis._tokens.push(token);\n\t\t}\n\n\t\tthis.clearSessionTimeout(token.sessionId);\n\n\t\tif (token.expiresIn) {\n\t\t\tthis._refreshTimeouts.set(token.sessionId, setTimeout(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait this.refreshToken(token.refreshToken, scope, token.sessionId);\n\t\t\t\t\tonDidChangeSessions.fire({ added: [], removed: [], changed: [token.sessionId] });\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e.message === REFRESH_NETWORK_FAILURE) {\n\t\t\t\t\t\tconst didSucceedOnRetry = await this.handleRefreshNetworkError(token.sessionId, token.refreshToken, scope);\n\t\t\t\t\t\tif (!didSucceedOnRetry) {\n\t\t\t\t\t\t\tthis.pollForReconnect(token.sessionId, token.refreshToken, token.scope);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait this.logout(token.sessionId);\n\t\t\t\t\t\tonDidChangeSessions.fire({ added: [], removed: [token.sessionId], changed: [] });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 1000 * (parseInt(token.expiresIn) - 30)));\n\t\t}\n\n\t\tthis.storeTokenData();\n\t}\n\n\tprivate getTokenFromResponse(buffer: Buffer[], scope: string, existingId?: string): IToken {\n\t\tconst json = JSON.parse(Buffer.concat(buffer).toString());\n\t\tconst claims = this.getTokenClaims(json.access_token);\n\t\treturn {\n\t\t\texpiresIn: json.expires_in,\n\t\t\texpiresAt: json.expires_in ? Date.now() + json.expires_in * 1000 : undefined,\n\t\t\taccessToken: json.access_token,\n\t\t\trefreshToken: json.refresh_token,\n\t\t\tscope,\n\t\t\tsessionId: existingId || `${claims.tid}/${(claims.oid || (claims.altsecid || '' + claims.ipd || ''))}/${uuid()}`,\n\t\t\taccountName: claims.email || claims.unique_name || 'user@example.com'\n\t\t};\n\t}\n\n\tprivate async exchangeCodeForToken(code: string, codeVerifier: string, scope: string): Promise<IToken> {\n\t\treturn new Promise((resolve: (value: IToken) => void, reject) => {\n\t\t\tLogger.info('Exchanging login code for token');\n\t\t\ttry {\n\t\t\t\tconst postData = querystring.stringify({\n\t\t\t\t\tgrant_type: 'authorization_code',\n\t\t\t\t\tcode: code,\n\t\t\t\t\tclient_id: clientId,\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tcode_verifier: codeVerifier,\n\t\t\t\t\tredirect_uri: redirectUrl\n\t\t\t\t});\n\n\t\t\t\tconst tokenUrl = vscode.Uri.parse(`${loginEndpointUrl}${tenant}/oauth2/v2.0/token`);\n\n\t\t\t\tconst post = https.request({\n\t\t\t\t\thost: tokenUrl.authority,\n\t\t\t\t\tpath: tokenUrl.path,\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t\t\t'Content-Length': postData.length\n\t\t\t\t\t}\n\t\t\t\t}, result => {\n\t\t\t\t\tconst buffer: Buffer[] = [];\n\t\t\t\t\tresult.on('data', (chunk: Buffer) => {\n\t\t\t\t\t\tbuffer.push(chunk);\n\t\t\t\t\t});\n\t\t\t\t\tresult.on('end', () => {\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\tLogger.info('Exchanging login code for token success');\n\t\t\t\t\t\t\tresolve(this.getTokenFromResponse(buffer, scope));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tLogger.error('Exchanging login code for token failed');\n\t\t\t\t\t\t\treject(new Error('Unable to login.'));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tpost.write(postData);\n\n\t\t\t\tpost.end();\n\t\t\t\tpost.on('error', err => {\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\n\t\t\t} catch (e) {\n\t\t\t\tLogger.error(e.message);\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async refreshToken(refreshToken: string, scope: string, sessionId: string): Promise<IToken> {\n\t\treturn new Promise((resolve: (value: IToken) => void, reject) => {\n\t\t\tLogger.info('Refreshing token...');\n\t\t\tconst postData = querystring.stringify({\n\t\t\t\trefresh_token: refreshToken,\n\t\t\t\tclient_id: clientId,\n\t\t\t\tgrant_type: 'refresh_token',\n\t\t\t\tscope: scope\n\t\t\t});\n\n\t\t\tconst post = https.request({\n\t\t\t\thost: 'login.microsoftonline.com',\n\t\t\t\tpath: `/${tenant}/oauth2/v2.0/token`,\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t\t'Content-Length': postData.length\n\t\t\t\t}\n\t\t\t}, result => {\n\t\t\t\tconst buffer: Buffer[] = [];\n\t\t\t\tresult.on('data', (chunk: Buffer) => {\n\t\t\t\t\tbuffer.push(chunk);\n\t\t\t\t});\n\t\t\t\tresult.on('end', async () => {\n\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\tconst token = this.getTokenFromResponse(buffer, scope, sessionId);\n\t\t\t\t\t\tthis.setToken(token, scope);\n\t\t\t\t\t\tLogger.info('Token refresh success');\n\t\t\t\t\t\tresolve(token);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tLogger.error('Refreshing token failed');\n\t\t\t\t\t\treject(new Error('Refreshing token failed.'));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tpost.write(postData);\n\n\t\t\tpost.end();\n\t\t\tpost.on('error', err => {\n\t\t\t\tLogger.error(err.message);\n\t\t\t\treject(new Error(REFRESH_NETWORK_FAILURE));\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate clearSessionTimeout(sessionId: string): void {\n\t\tconst timeout = this._refreshTimeouts.get(sessionId);\n\t\tif (timeout) {\n\t\t\tclearTimeout(timeout);\n\t\t\tthis._refreshTimeouts.delete(sessionId);\n\t\t}\n\t}\n\n\tprivate removeInMemorySessionData(sessionId: string) {\n\t\tconst tokenIndex = this._tokens.findIndex(token => token.sessionId === sessionId);\n\t\tif (tokenIndex > -1) {\n\t\t\tthis._tokens.splice(tokenIndex, 1);\n\t\t}\n\n\t\tthis.clearSessionTimeout(sessionId);\n\t}\n\n\tprivate pollForReconnect(sessionId: string, refreshToken: string, scope: string): void {\n\t\tthis.clearSessionTimeout(sessionId);\n\n\t\tthis._refreshTimeouts.set(sessionId, setTimeout(async () => {\n\t\t\ttry {\n\t\t\t\tawait this.refreshToken(refreshToken, scope, sessionId);\n\t\t\t} catch (e) {\n\t\t\t\tthis.pollForReconnect(sessionId, refreshToken, scope);\n\t\t\t}\n\t\t}, 1000 * 60 * 30));\n\t}\n\n\tprivate handleRefreshNetworkError(sessionId: string, refreshToken: string, scope: string, attempts: number = 1): Promise<boolean> {\n\t\treturn new Promise((resolve, _) => {\n\t\t\tif (attempts === 3) {\n\t\t\t\tLogger.error('Token refresh failed after 3 attempts');\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\n\t\t\tif (attempts === 1) {\n\t\t\t\tconst token = this._tokens.find(token => token.sessionId === sessionId);\n\t\t\t\tif (token) {\n\t\t\t\t\ttoken.accessToken = undefined;\n\t\t\t\t\tonDidChangeSessions.fire({ added: [], removed: [], changed: [token.sessionId] });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst delayBeforeRetry = 5 * attempts * attempts;\n\n\t\t\tthis.clearSessionTimeout(sessionId);\n\n\t\t\tthis._refreshTimeouts.set(sessionId, setTimeout(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait this.refreshToken(refreshToken, scope, sessionId);\n\t\t\t\t\treturn resolve(true);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn resolve(await this.handleRefreshNetworkError(sessionId, refreshToken, scope, attempts + 1));\n\t\t\t\t}\n\t\t\t}, 1000 * delayBeforeRetry));\n\t\t});\n\t}\n\n\tpublic async logout(sessionId: string) {\n\t\tLogger.info(`Logging out of session '${sessionId}'`);\n\t\tthis.removeInMemorySessionData(sessionId);\n\n\t\tif (this._tokens.length === 0) {\n\t\t\tawait keychain.deleteToken();\n\t\t} else {\n\t\t\tthis.storeTokenData();\n\t\t}\n\t}\n\n\tpublic async clearSessions() {\n\t\tLogger.info('Logging out of all sessions');\n\t\tthis._tokens = [];\n\t\tawait keychain.deleteToken();\n\n\t\tthis._refreshTimeouts.forEach(timeout => {\n\t\t\tclearTimeout(timeout);\n\t\t});\n\n\t\tthis._refreshTimeouts.clear();\n\t}\n}\n","module.exports = require(\"https\");","module.exports = require(\"querystring\");","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/uuidjs/uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as http from 'http';\nimport * as url from 'url';\nimport * as fs from 'fs';\nimport * as net from 'net';\nimport * as path from 'path';\n\ninterface Deferred<T> {\n\tresolve: (result: T | Promise<T>) => void;\n\treject: (reason: any) => void;\n}\n\nconst _typeof = {\n\tnumber: 'number',\n\tstring: 'string',\n\tundefined: 'undefined',\n\tobject: 'object',\n\tfunction: 'function'\n};\n\n/**\n * @returns whether the provided parameter is undefined.\n */\nexport function isUndefined(obj: any): obj is undefined {\n\treturn typeof (obj) === _typeof.undefined;\n}\n\n/**\n * @returns whether the provided parameter is undefined or null.\n */\nexport function isUndefinedOrNull(obj: any): obj is undefined | null {\n\treturn isUndefined(obj) || obj === null;\n}\n\n/**\n * Asserts that the argument passed in is neither undefined nor null.\n */\nexport function assertIsDefined<T>(arg: T | null | undefined): T {\n\tif (isUndefinedOrNull(arg)) {\n\t\tthrow new Error('Assertion Failed: argument is undefined or null');\n\t}\n\n\treturn arg;\n}\n\nexport function createTerminateServer(server: http.Server) {\n\tconst sockets: Record<number, net.Socket> = {};\n\tlet socketCount = 0;\n\tserver.on('connection', socket => {\n\t\tconst id = socketCount++;\n\t\tsockets[id] = socket;\n\t\tsocket.on('close', () => {\n\t\t\tdelete sockets[id];\n\t\t});\n\t});\n\treturn async () => {\n\t\tconst result = new Promise<Error | undefined>(resolve => server.close(resolve));\n\t\tfor (const id in sockets) {\n\t\t\tsockets[id].destroy();\n\t\t}\n\t\treturn result;\n\t};\n}\n\nexport async function startServer(server: http.Server): Promise<string> {\n\tlet portTimer: NodeJS.Timer;\n\n\tfunction cancelPortTimer() {\n\t\tclearTimeout(portTimer);\n\t}\n\n\tconst port = new Promise<string>((resolve, reject) => {\n\t\tportTimer = setTimeout(() => {\n\t\t\treject(new Error('Timeout waiting for port'));\n\t\t}, 5000);\n\n\t\tserver.on('listening', () => {\n\t\t\tconst address = server.address();\n\t\t\tif (typeof address === 'string') {\n\t\t\t\tresolve(address);\n\t\t\t} else {\n\t\t\t\tresolve(assertIsDefined(address).port.toString());\n\t\t\t}\n\t\t});\n\n\t\tserver.on('error', _ => {\n\t\t\treject(new Error('Error listening to server'));\n\t\t});\n\n\t\tserver.on('close', () => {\n\t\t\treject(new Error('Closed'));\n\t\t});\n\n\t\tserver.listen(0);\n\t});\n\n\tport.then(cancelPortTimer, cancelPortTimer);\n\treturn port;\n}\n\nfunction sendFile(res: http.ServerResponse, filepath: string, contentType: string) {\n\tfs.readFile(filepath, (err, body) => {\n\t\tif (err) {\n\t\t\tconsole.error(err);\n\t\t\tres.writeHead(404);\n\t\t\tres.end();\n\t\t} else {\n\t\t\tres.writeHead(200, {\n\t\t\t\t'Content-Length': body.length,\n\t\t\t\t'Content-Type': contentType\n\t\t\t});\n\t\t\tres.end(body);\n\t\t}\n\t});\n}\n\nasync function callback(nonce: string, reqUrl: url.Url): Promise<string> {\n\tconst query = reqUrl.query;\n\tif (!query || typeof query === 'string') {\n\t\tthrow new Error('No query received.');\n\t}\n\n\tlet error = query.error_description || query.error;\n\n\tif (!error) {\n\t\tconst state = (query.state as string) || '';\n\t\tconst receivedNonce = (state.split(',')[1] || '').replace(/ /g, '+');\n\t\tif (receivedNonce !== nonce) {\n\t\t\terror = 'Nonce does not match.';\n\t\t}\n\t}\n\n\tconst code = query.code as string;\n\tif (!error && code) {\n\t\treturn code;\n\t}\n\n\tthrow new Error((error as string) || 'No code received.');\n}\n\nexport function createServer(nonce: string) {\n\ttype RedirectResult = { req: http.IncomingMessage; res: http.ServerResponse; } | { err: any; res: http.ServerResponse; };\n\tlet deferredRedirect: Deferred<RedirectResult>;\n\tconst redirectPromise = new Promise<RedirectResult>((resolve, reject) => deferredRedirect = { resolve, reject });\n\n\ttype CodeResult = { code: string; res: http.ServerResponse; } | { err: any; res: http.ServerResponse; };\n\tlet deferredCode: Deferred<CodeResult>;\n\tconst codePromise = new Promise<CodeResult>((resolve, reject) => deferredCode = { resolve, reject });\n\n\tconst codeTimer = setTimeout(() => {\n\t\tdeferredCode.reject(new Error('Timeout waiting for code'));\n\t}, 5 * 60 * 1000);\n\n\tfunction cancelCodeTimer() {\n\t\tclearTimeout(codeTimer);\n\t}\n\n\tconst server = http.createServer(function (req, res) {\n\t\tconst reqUrl = url.parse(req.url!, /* parseQueryString */ true);\n\t\tswitch (reqUrl.pathname) {\n\t\t\tcase '/signin':\n\t\t\t\tconst receivedNonce = ((reqUrl.query.nonce as string) || '').replace(/ /g, '+');\n\t\t\t\tif (receivedNonce === nonce) {\n\t\t\t\t\tdeferredRedirect.resolve({ req, res });\n\t\t\t\t} else {\n\t\t\t\t\tconst err = new Error('Nonce does not match.');\n\t\t\t\t\tdeferredRedirect.resolve({ err, res });\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '/':\n\t\t\t\tsendFile(res, path.join(__dirname, '../media/auth.html'), 'text/html; charset=utf-8');\n\t\t\t\tbreak;\n\t\t\tcase '/auth.css':\n\t\t\t\tsendFile(res, path.join(__dirname, '../media/auth.css'), 'text/css; charset=utf-8');\n\t\t\t\tbreak;\n\t\t\tcase '/callback':\n\t\t\t\tdeferredCode.resolve(callback(nonce, reqUrl)\n\t\t\t\t\t.then(code => ({ code, res }), err => ({ err, res })));\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tres.writeHead(404);\n\t\t\t\tres.end();\n\t\t\t\tbreak;\n\t\t}\n\t});\n\n\tcodePromise.then(cancelCodeTimer, cancelCodeTimer);\n\treturn {\n\t\tserver,\n\t\tredirectPromise,\n\t\tcodePromise\n\t};\n}\n","module.exports = require(\"http\");","module.exports = require(\"url\");",null,"module.exports = require(\"keytar\");","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport function toBase64UrlEncoding(base64string: string) {\n\treturn base64string.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_'); // Need to use base64url encoding\n}\n"],"sourceRoot":""}